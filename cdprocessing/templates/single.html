{% extends "base.html" %}

{% block title %}Single Run{% endblock %}

{% block main %}

<form id="file-input" method="POST" enctype="multipart/form-data">
  <div id="blank-input">
    <h2>CD Blanks</h2>
    <label for="blank_id" class="btn">Upload a blank file...</label>
    <input name="blank" type="file" id="blank_id" multiple>
    {% csrf_token %}
  </div><div id="sample-input">
    <h2>CD Samples</h2>
    <label for="sample_id" class="btn">Upload a sample file...</label>
    <input name="sample" type="file" id="sample_id" multiple>
  </div>
  <div id="input-errors">{{ error_text }}</div>
  <input type="submit" value="Process">
</form>

<div id="output">
  {% if display_chart %}
  <div id="chart"></div>
  <script>
  var chart = Highcharts.chart("chart", {
      title: {
        text: "{{ title }}"
      },
      chart: {
        type: "line",
        plotBorderWidth: 1,
        plotBorderColor: "#000000",
        margin: [50, 30, 50, 75],
        zoomType: "xy",
        height: "50%"
      },
      credits: {
        enabled: false
      },
      legend: {
        enabled: false
      },
      xAxis: {
        min: {{ min }},
        max: {{ max }},
        gridLineWidth: 1,
        gridLineColor: "#EEEEEE",
        gridLineDashStyle: "ShortDash",
        lineColor: "#000000",
        tickWidth: 1,
        tickLength: 6,
        tickPosition: "inside",
        tickColor: "#000000",
        title: {
          text: "Wavelength (nm)",
          style: {"font-weight": "bold"}
        }
      },
      yAxis: {
        gridLineWidth: 1,
        gridLineColor: "#EEEEEE",
        gridLineDashStyle: "ShortDash",
        tickWidth: 1,
        tickLength: 6,
        tickPosition: "inside",
        lineColor: "#000000",
        tickColor: "#000000",
        title: {
          text: "Absorbance",
          style: {"font-weight": "bold"}
        }
      },
      tooltip: {
        enabled: false
      },
      series: [{
        data: {{ errors }},
        type: "arearange",
        fillOpacity: 0.2,
        lineWidth: 0,
        enableMouseTracking: false
      }, {
        data: {{ average_absorbance }},
        marker: {
          enabled: false,
          states: {
            hover: {
              enabled: false
            }
          }
        }
      },{% for input in input_series %}
      {
        data: {{ input }},
        lineWidth: 1,
        visible: false,
        marker: {
          enabled: false,
          states: {
            hover: {
              enabled: false
            }
          }
        }
      },
      {% endfor %}
      ]
    });
  </script>
  <div id="chart-config">
    <button id="toggle-inputs">Toggle Inputs</button>
  </div>
  <form method="POST">
    <input type="hidden" name="series" value="{{ file_series }}">
    <input type="hidden" name="filename" value="{{ filename }}">
    {% csrf_token %}
    <input type="submit" id="download" value="Download data file">
  </form>
  <script>
    $( document ).ready(function() {
      $("html, body").animate({
        scrollTop: $("#chart").offset().top
    }, 800);
    });

    $("#toggle-inputs").click(function () {
      for (s of chart.series) {
        console.log(s.options.lineWidth);
        if (s.options.lineWidth == 1) {
          if (s.visible) {
            s.hide();
          } else {
            s.show();
          }
        }
      }
    });
  </script>
  {% endif %}
</div>
{% endblock %}
