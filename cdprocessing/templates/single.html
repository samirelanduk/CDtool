{% extends "base.html" %}

{% block title %}Single Run{% endblock %}

{% block css %}
<style>
  main {
    text-align: center;
    width: inherit;
  }
</style>
{% endblock %}

{% block main %}

<form id="input" method="POST" enctype="multipart/form-data">

  <div id="file-input">
    <fieldset class="file-fieldset">
      <h2>CD Blanks</h2>
      <input name="sample_files" type="file" multiple>
      <input name="sample_name" type="text">
    </fieldset>
  </div>

  <fieldset id="input-parameters">
    <input type="text" name="title" id="id_title">
  </fieldset>

  {% csrf_token %}
  <input type="submit" value="Process">
</form>

<div id="output">
  {% if display_chart %}
  <div id="chart"></div>
  <script>
  var chart = Highcharts.chart("chart", {
      title: {
        text: "{{ title }}"
      },
      chart: {
        type: "line",
        plotBorderWidth: 1,
        plotBorderColor: "#000000",
        margin: [50, 30, 50, 75],
        zoomType: "xy",
        height: "50%"
      },
      credits: {
        enabled: false
      },
      legend: {
        enabled: false
      },
      plotOptions: {
        arearange: {
          animation: true
        }
      },
      xAxis: {
        min: {{ min }},
        max: {{ max }},
        gridLineWidth: 1,
        gridLineColor: "#EEEEEE",
        gridLineDashStyle: "ShortDash",
        lineColor: "#000000",
        tickWidth: 1,
        tickLength: 6,
        tickPosition: "inside",
        tickColor: "#000000",
        title: {
          text: "Wavelength (nm)",
          style: {"font-weight": "bold"}
        }
      },
      yAxis: {
        gridLineWidth: 1,
        gridLineColor: "#EEEEEE",
        gridLineDashStyle: "ShortDash",
        tickWidth: 1,
        tickLength: 6,
        tickPosition: "inside",
        lineColor: "#000000",
        tickColor: "#000000",
        title: {
          text: "Circular Dichroism",
          style: {"font-weight": "bold"}
        }
      },
      tooltip: {
        enabled: false
      },
      series: [{
        data: {{ cd_error }},
        id: 1,
        color: "#4A9586",
        type: "arearange",
        fillOpacity: 0.2,
        lineWidth: 0,
        enableMouseTracking: false
      }, {
        data: {{ cd }},
        id: 2,
        color: "#4A9586",
        marker: {
          enabled: false,
          states: {
            hover: {
              enabled: false
            }
          }
        }
      }]
    });
  </script>
  <div id="chart-config">
    <div id="series-config">
      <div class="series-title">{{ sample_name }}</div>
      <button class="error-option" id="series-error-option">Toggle Error</button>
      <script>
      $("#series-error-option").click(function () {
        series = chart.get(1);
        if (series.visible) {
          series.hide();
        } else {
          series.show();
        }
      });
      </script>
      <button class="display-option" id="series-display-option">Toggle Series</button>
      <script>
      $("#series-display-option").click(function () {
        series = chart.get(2);
        error = chart.get(1);
        if (series.visible) {
          series.hide();
          error.hide();
        } else {
          series.show();
          error.show();
        }
      });
      </script>
    </div>
  </div>
  <form method="POST">
    <input type="hidden" name="series" value="{{ file_series }}">
    <input type="hidden" name="filename" value="{{ filename }}">
    {% csrf_token %}
    <input type="submit" id="download" value="Download data file">
  </form>
  <script>
    $( document ).ready(function() {
      $("html, body").animate({
        scrollTop: $("#chart").offset().top
    }, 800);
    });
  </script>
  {% endif %}
</div>
{% endblock %}
